input {
  ## ë„ì»¤ ì»¨í…Œì´ë„ˆ ë¡œê·¸ (stdout/stderr)
  file {
    path => "/var/lib/docker/containers/*/*.log"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    codec => json
    tags => ["docker"]
  }

  ## Spring Boot ì•± ë¡œê·¸
  file {
    path => "/logs/app.log"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    codec => multiline {
      pattern => "^\d{4}-\d{2}-\d{2}"
      negate => true
      what => "previous"
    }
    tags => ["springboot"]
  }
}

filter {
  ## ğŸ” Docker ë¡œê·¸: container_id ì¶”ì¶œ
  if "docker" in [tags] {
    grok {
      match => { "path" => "/var/lib/docker/containers/%{DATA:container_id}/%{GREEDYDATA}" }
    }

    ## (ì„ íƒ) ë©”ì‹œì§€ í•„ë“œ ì´ë¦„ ë³€ê²½
    mutate {
      rename => { "log" => "message" }
    }

    ## Docker APIë¥¼ í†µí•´ container_nameì„ ê°€ì ¸ì˜¤ë ¤ë©´ ruby ì½”ë“œ or external enrichment í•„ìš”í•¨
    ## ì—¬ê¸°ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ container_idë§Œ í¬í•¨ì‹œí‚´
  }

  ## ëª¨ë“  ë¡œê·¸ì— ê³µí†µ í•„ë“œ ì¶”ê°€
  mutate {
    add_field => {
      "ingested_at" => "%{@timestamp}"
    }
  }

  ## ë¡œê·¸ êµ¬ì¡° ì •ë¦¬
  mutate {
    remove_field => ["host", "stream", "input", "attrs"]
  }
}

output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "docker-logs-%{+YYYY.MM.dd}"
  }

  stdout { codec => rubydebug }
}
